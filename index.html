<html>
  <head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
	<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
	<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <!-- <script src="https://rawgit.com/nicolocarpignoli/nicolocarpignoli.github.io/master/ar-click-events/events.js"></script> -->
  </head>
  <script type="text/javascript">		
	AFRAME.registerComponent('markerhandler', {

	init: function() {
		const animatedMarker = document.querySelector("#animated-marker");
		const aEntity = document.querySelector("#animated-model");

		const grow = document.querySelector("#boxGrow");
		const shrink = document.querySelector("#boxShrink");

		// every click, we make our model grow in size :)
		animatedMarker.addEventListener('click', function(ev, target){
			const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
			if (grow && intersectedElement === grow) {
				const scale = aEntity.getAttribute('scale');
				Object.keys(scale).forEach((key) => scale[key] = scale[key] + 0.01);
				aEntity.setAttribute('scale', scale);

				const boxRed = grow.getAttribute('scale');
				Object.keys(boxRed).forEach((key) => boxRed[key] = boxRed[key] + 0.05);
				grow.setAttribute('scale', boxRed);

				const boxGreen = shrink.getAttribute('scale');
				Object.keys(boxGreen).forEach((key) => boxGreen[key] = boxGreen[key] + 0.05);
				shrink.setAttribute('scale', boxGreen);
			}

			if (shrink && intersectedElement === shrink) {
				const scale = aEntity.getAttribute('scale');
				Object.keys(scale).forEach((key) => scale[key] = scale[key] - 0.01);
				aEntity.setAttribute('scale', scale);

				const boxRed = grow.getAttribute('scale');
				Object.keys(boxRed).forEach((key) => boxRed[key] = boxRed[key] - 0.05);
				grow.setAttribute('scale', boxRed);

				const boxGreen = shrink.getAttribute('scale');
				Object.keys(boxGreen).forEach((key) => boxGreen[key] = boxGreen[key] - 0.05);
				shrink.setAttribute('scale', boxGreen);
			}
		});
	}});
</script>
  <body style='margin : 0px; overflow: hidden;'>

	<a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>

		<a-assets>
			<a-asset-item id="voltorb" src="models/voltorb.glb"></a-asset-item>
		</a-assets>

		<a-marker preset="custom" type="pattern" url="models/pattern-pokeball.patt" markerhandler emitevents="true" cursor="rayOrigin: mouse" id="animated-marker">
			<a-text position="-0.5 1 0" value="VOLTORB"></a-text>
			<a-entity
			id="animated-model"
			gltf-model="#voltorb"
			scale="0.15 0.15 0.15" 
			position="0 0 0"
			></a-entity>
			<a-box id="boxGrow" position="-1 0 0" rotation="0 0 0" scale="0.5 0.5 0.5" color="green">
				<a-entity position="1.25 0.5 1" scale="3 3 3" text="value: GROW; color:black"></a-entity>
			</a-box>
			<a-box id="boxShrink" position="1 0 0" rotation="0 0 0" scale="0.5 0.5 0.5" color="red">
				<a-entity position="1.25 0.5 1" scale="3 3 3" text="value: SHRINK; color:black"></a-entity>
			</a-box>
		</a-marker>

		<a-entity camera></a-entity>

	</a-scene>

	<!-- <script type="text/javascript">
		AFRAME.registerComponent('startButton', {
		  init: function () {
			var cube = document.querySelector('a-scene').sceneEl.querySelector("#boxId");
			cube.addEventListener("mousedown", function (evt) {
			  cube.setAttribute('material', 'color', 'red');
			});
			cube.addEventListener("mouseup", function (evt) {
			  cube.setAttribute('material', 'color', 'green');//we want to change this from "blue" to "green" to avoid some bugs
			});
			cube.addEventListener("mouseenter", function (evt) {
			  cube.setAttribute('material', 'color', 'green');
			});
			cube.addEventListener("mouseleave", function (evt) {
			  cube.setAttribute('material', 'color', 'blue');
			});
		  }
		});
	</script> -->


  </body>
</html>